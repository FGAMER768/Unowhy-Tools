/*

                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
      ░▒▓▓▒▓▒▓▒▒                                                     ░▒▓▓▓▓▓▒▓▒░                                                     ▒▓▓▒▓▒▓▓▒        
     ▓███████████▒                                                 ░█████████████░                                                 ▒███████████▓      
    ▓█████████████░                                                ███████████████                                                ▒█████████████▓     
    ███▓█▓█▓█▓█▓██▒                                               ░████▓█▓███▓████░                                               ▒████▓█▓█▓█▓███     
    ████▓█▓█▓█▓███▒                                                ███▓█▓█▓█▓█████░                                               ▒███▓██████████     
    ███▓█▓█████▓██▒                                               ░████▓█▓███▓████░                                               ▒██▓█▓█▓█▓█▓███     
    ████▓█▓█▓█████▒                                                ███▓█▓█▓█▓█▓███░                                               ▒███▓█▓█▓█▓████     
    ███▓█▓█▓███▓██▒                                               ░██▓█▓█▓█▓█▓████░                                               ▒██▓█▓███▓█▓███     
    ████▓█▓███▓███▒                                               ░███▓███▓█▓█▓███░                                               ▒███▓█▓█▓█▓████     
    ███▓█▓█▓█▓█▓██▒                                               ░████▓███▓█▓████░                                               ▒████▓█▓███▓███     
    ████▓█▓█▓█████▒                                               ░███▓███▓█▓█▓███░                                               ▒███▓█▓█▓██████     
    ███▓█▓█▓█▓████▒                                               ░████▓█▓█▓█▓████░                                               ▒██▓█▓█▓█▓█████     
    ████▓███▓█▓███▒                                                ███▓█████▓█▓███░                                               ▒█████▓█▓█▓████     
    █████▓█▓█▓█▓██▒                                               ░████▓█▓█▓██████░                                               ▒██▓███▓█▓█▓███     
    ██████▓█▓█▓███▒                                                ███▓█▓█▓█▓█▓███░                                               ░███▓█▓█▓█▓████     
    ███▓█▓███▓█▓███▓░                                             ░████▓█▓█▓█▓█▓██░                                             ░▓█████▓█████▓███     
    ████▓███████▓█████▓▒                                           ███▓███▓█▓█▓███░                                          ▒▓█████▓█▓█▓█▓██████     
    ███▓█▓█▓█▓█▓█████████▓▓░                                      ░████▓█▓█▓█▓█▓██░                                      ░▓████████▓███▓█▓█▓█▓███     
    ████▓█▓█▓█▓███▓█▓████████▓▒                                   ░███████████████░                                   ▒▓████████▓█▓█▓█████▓█▓████     
    ███████▓█▓█▓█▓█▓█▓█▓████████▓▒░                                ▓█████████████▓                                ░▒█████████▓█▓█▓█▓█▓███▓███████     
     ███████▓███▓█▓█▓█▓█▓███████████▓░                              ▒▓██████████▒                              ░▓█████████▓███▓█▓█▓█▓███████████      
      ░▓█████████▓█▓█▓█▓█▓█▓█▓█████████▓▒                                                                   ▒▓███████████▓█▓███▓█████████████▓░       
          ▒▓████████████▓█▓███▓█▓██████████▓░                                                           ░▓████████▓█▓███▓█████▓██████████▓▒           
             ░▓██████████▓█▓█▓█████▓█▓████████▓▒                                                     ▒▓████████▓█▓█▓█▓█▓█▓████████████▓░              
                 ▒▓███████▓█▓█▓█▓█▓█▓█████████████▒░                                             ░▒█████████▓█▓███▓█▓█▓█▓█████████▓▒                  
                    ▒▓█████████▓█▓█▓█▓█████▓█████████▓▒                                       ▒▓███████████▓█▓█▓█▓█████████████▓▒                     
                       ░▒███████████▓█▓█▓█▓███▓█████████▓▒                                 ▒▓███████▓█▓███████▓█▓███████████▒░                        
                           ▒▓████████▓█▓█▓█▓█▓██████████████▓░                         ░▓████████▓█▓█▓█▓█████▓█▓████████▓▒                            
                              ░▓██████████▓█▓█▓█▓███▓█▓████████▓▒                   ▒▓████████▓█▓█▓█▓█▓█▓████████████▓░                               
                                  ▒▓███████▓█▓█▓█▓█▓█▓█▓█▓█████████▒░           ░▒█████████▓███▓█▓███▓█▓█████████▓▒                                   
                                     ░▓█████████▓█▓█▓█▓█▓█▓█▓█████████▓▒     ▒▓█████████▓█▓█▓███▓█▓███████████▓▒                                      
                                        ░▒▓████████▓█▓█▓█▓█▓█▓█▓█████████▓▓▓█████████▓█▓█▓███▓█▓███████████▒                                          
                                            ▒▓██████████▓█▓█▓█▓█▓█▓█▓███████████▓█▓█████▓█▓█▓██████████▓▒                                             
                                               ░▒██████████▓█▓█▓█▓█▓█▓█████████▓█▓█▓█▓███▓█▓████████▓░                                                
                                                   ▒▓███████████▓█▓█▓███▓█▓█▓███▓█▓█▓███████████▓▒                                                    
                                                      ░▓█████████▓█▓█▓███▓█▓█▓█▓███▓█████████▓░                                                       
                                                          ▒▓████████▓█▓█▓█▓█▓█▓██████████▓▒                                                           
                                                             ▒▓██████▓███▓███▓█▓██████▓▒                    ░▒▓▓               ░▓▓▒░                  
                                                                ░▒▓█████▓███▓█▓███▓▒░                    ▒▓▓▓▓▓▓▓░            ▒▓▓▓▓▓▓▒░               
                                                                   ██▓███▓███▓████                    ░▒▓▓▓▓▓▓▓▓▓▓▓░        ▒▓▓▓▓▓▓▓▓▓▓▓▒             
                                                                   █████▓█▓█▓█▓███                   ░█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓            
                                                                  ░████▓███▓█▓████░                   ▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓░            
                                                                  ░███▓█▓█▓█▓█▓███░                    ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒             
                                                                  ░██████▓█▓█▓█▓██░                    ▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒             
                                                                   █████▓█▓█▓█████░                    ▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒░░░░░▒▒▓▓▓▓▓▓▓▓▓▓▓▒             
                                                                  ░██▓█▓███▓█▓█▓██░                   ▒▓▓▓▓▓▓▓▓▓▒░░░░         ░▒▓▓▓▓▓▓▓▓▓             
                                                                   █████▓█▓█▓█▓███░                  ░▓▓▓▓▓▓▓▓▒░░░   ░░░░░       ▒▓▓▓▓▓▓▓▓            
                                                                  ░██▓█▓█▓█▓██████░                 ▒▓▓▓▓▓▓▓▓░░░░ ▒▓███████▓▓░     ▓▓▓▓▓▓▓▓▒          
                                                                   ███▓█▓█▓█▓█████░             ░▒▓▓▓▓▓▓▓▓▓▓░░░ ░▓████████████▓  ░  ▓▓▓▓▓▓▓█▓▓░       
                                                                  ░████▓█▓█▓█▓████░         ░█▓▓▓▓▓▓▓▓▓▓▓▓▓░░░ ░████████████████  ░  ▓▓▓▓▓▓▓▓▓████▓   
                                                                  ░███▓█▓█▓█▓█████░         ▒█▓▓▓▓▓▓▓▓▓▓▓▓▒░░░ █████▓███▓███████▓    ▒▓▓▓▓▓▓▓▓▓▓▓▓█░  
                                                                   ███████████████          ▒▓▓▓▓▓▓▓▓▓▓▓▓▓░░░ ▒████▓█████████████    ░█▓▓▓▓▓▓▓▓▓▓▓█░  
                                                                   ░█████████████░          ▒▓▓▓▓▓▓▓▓▓▓▓▓▓░░░ ▒██████████████████░   ░▓▓▓▓▓▓▓▓▓▓▓▓█░  
                                                                     ░▒▒▒▒▒▒▓▒▒░            ▒▓▓▓▓▓▓▓▓▓▓▓▓▓░ ░ ░██████████████████    ▒█▓▓▓▓▓▓▓▓▓▓▓█░  
                                                                                            ░█▓▓▓▓▓▓▓▓▓▓▓▓▒  ░ ▓████████████████░    ▓▓▓▓▓▓▓▓▓▓████   
                                                                                             ▒▒▒▓▓▓▓▓▓▓▓▓▓▓░    ▓██████████████▒    ▒█▓▓▓▓▓▓██▓▓▓▓▒   
                                                                                                   ▒▓▓▓▓▓▓▓▓░    ░▓██████████▓     ░█▓▓▓▓▓██▒         
                                                                                                     ▓█▓▓▓▓▓▓▒      ░▒▓▓▓▓▒░      ▒█▓▓▓▓▓█▓           
                                                                                                      ▒▓▓▓▓▓▓█▓░                ░▓█▓▓▓▓▓█▒            
                                                                                                       ▓▓▓▓▓▓▓▓▓▓▒░          ░▓▓█▓▓▓▓▓▓▓▓             
                                                                                                       ▓▓▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓███▓▓▓▓▓▓▓▓█▒             
                                                                                                       ▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓██▓▓▓▓▓▓▓▓▓▓▓▓▓█▒             
                                                                                                       █▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓             
                                                                                                      ██▓▓▓▓▓▓▓▓▓▓▓▓████████▓▓▓▓▓▓▓▓▓▓▓▓█▓            
                                                                                                      ▓██▓▓▓▓▓▓▓▓▓█▓▒▒░░░░▒▓▓█▓▓▓▓▓▓▓▓███▓            
                                                                                                        ▒▓███▓▓▓█▓░          ░▓█▓▓▓███▓▒              
                                                                                                           ▒▓███▒              ▓███▓▒░                
                                                                                                              ░░                ░░                    
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      
                                                                                                                                                      

                                       


                                                                ░░░░░░░░░░░░░░░░░░░░░░▒░    ░                                                         
                               ██████████████████████████████████████████████████████████████████████████████████████████                             
                              ▒█████████████████████████████████████████████████████████████  ███████████████████████████                             
                              ░█████████████████████████████████████████████████████████████  ███████████████████████████                             
                              ░█████████████████████████████████████████████████████████████  ███████████████████████████                             
                              ░█████████████████████████████████████████████████████████████  ███████████████████████████                             
                              ░████████████▓▓▓▓▓▓▓▓█████████████████████████████████████████  ███████████████████████████                             
                              ░███████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓                             ▒█████  ███████████████████████████                             
                              ░████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█  ▒▒▒▒▒▒▒▒▒▒▓▓▓▓▓▒ ░▓▓▓▓▓▓▓▒ ░█████  ███████████████████████████                             
                              ░███▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█  █████████▓██████ ▓████████ ░█▓▓▓█  █▓▓▓▓▓█████████████████████                             
                              ▒██▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█  ████████▓▓▓▓▓▓▓▒ ▒██▓▓▓▓▓▒ ░█▓▓▓█  ▓▓▒▒▒▒▒▒▒▓▓██████████▓▓▓▓▓█                             
                              ░█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█           █▓▓▓▓█▒ ░▓▒▒▒▒▒▓▒         ▓▓▓▓▓▓▒▓▒▒▒▒▒▓▓█▓▓▓▓▓▓▓▓▓██                             
                              ▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▓▒▓▒▓▒▓▓▓▒  █▓▓▒▒▓▒ ░▓▒▒▒▒▒▒▒▒▒▒░ ░▓▓▒▓▓▓▓▓▓▓▒▓▓▓▓▓▒▒▒▓▓▓▓▓▓▓▓▓▓█                             
                              ▒█████▓▓▓▓▒▓▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓██▓  ▓▒▒▒▒▓▒ ░▓▒▒▒▒▒▒▒▓▓▓░ ░█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▓▓▓▓▓▓▓█                             
                              ▒█▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒  ▓▒▒▒▓▓▒ ░▓▓▒▒▒▒▒▒▒▓▓▒ ▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓███                             
                              ▒▒                                   ░▓▓▓▓▓▓▒ ▒█▓▓▓▓▓▓▓▓▓█▒ ▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█                             
                              ▒█▓▓▓▓▓▓▓▓▓▓███████████████▓▓▓▓▓▓▓▓▓█▓▓▓▓▓▓▓███████▓█▓▓▓█▓▓▓█▓█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒█                             
                              ▒█▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓    ▓█▒         ▓▒            ▒█▓    ▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓█                             
                              ▒█▒▒▒▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▓  ▓█▒ ░▓▓▓▓▓▒▓█▒ ▒▓▓▒▓▒▓▒▓░ ▒█▓▓▓  █▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                             
                              ▒█▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█░ ▓█▒ ▒██▓▓▓▓▓█░ ▒█▓▓▓█▓██▒ ▒█▓▓█  ▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒█                             
                              ▒█▒▓▓▓▓▓▓▒▓▒▓▓▓▒▓▓▓▓▓▓▓▓▓▓▓▓█  ▓█▒ ░█▓▓▓▓▓▓█▒ ▒█▓▓▓▓▓▓█░ ▒█▓▓█  █▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓▒▒▒▒▒█                             
                              ▒███▓▓▓▓▓▓▓▓▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▓▓  ▓█▒ ▒█▓▓▓▓▓▓█▒ ▒█▓▓▓▓▓██▒ ▓████  ████▓█▓█▓█▓█▓█▓█▓█▓████▓▓▓█                             
                              ▒███████████████▓▓▓▓▓▓▓▓▓▓▓▓█  ██▒ ▒███▓█▓██▒ ▒█▓▓▓▓▓▓█▒ ▒█▓██  ██▓▓▓▓▓▓▓▓█▓▓▓▓▓█▓▓▓█▓█▓▓▓█                             
                              ▒██████████████████████▓▓▓▓▓█  ██▒ ▒██▓█████▒ ▒████████▒ ▒█▓▓█  ███████████████████████████                             
                              ▒████████████████████████████  ██▒  ▒▒▒▒▒▒▒▒░ ▒▓▒▒▒▒▒▒▒  ▒█▓▓█  ▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▓▓▓█                             
                              ▒████████████████████████████░ ██▓            ▒▒         ▒▓▓▓█                            █░                            
                              ▒████████████████████████████  ███████████████████████████▓▓▓▓█████████████████████████████                             
                              ▒████████████████████████████░ ████████████████████████████████████████████████████████████                             
                              ▒████████████████████████████  ████████████████████████████████████████████████████████████                             
                              ▒████████████████████████████░ ████████████████████████████████████████████████████████████                             
                              ▒████████████████████████████  ████████████████████████████████████████████████████████████                             
                              ▒████████████████████████████  ████████████████████████████████████████████████████████████                             
                              ▒██████████████████████████████████████████████████████████████████████████████████████████                             
                              ▒██████████████████████████████████████████████████████████████████████████████████████████                             
                              ▒████████▓▓▓▓▓█▓█▓█▓█▓███▓█▓███████████████████████████████████████████████████████████████                             
                              ▒█▓▓▓▓▓▓▓▓▓▓▓█▓▓▓▓▓▓▓▓▓█▓█▓█▓█▓████████████████████████████████████████████████████▓▓▓▓▓▓██                             
                              ███████████████████████████████████████████████████████████████████████████████████████████▓                            
                             ███████████████████████████████████████████████████████████████▓█████████████████████████████▒                           
                            ▒█▓██████████████████████████████████████████████████████████████████████████████████████████▓█                           
                           ░█▓▓▓████████████████████████████████████████████████████████████████████████████████████████▓▓██                          
                           ██▓▓▓████████████████████████████████████████████████████████████████████████████████████████▓▓▓█▓                         
                          ▓█▓▓▓▓████████████████████████████████████████████████████████████████████████████████████████▓▓▓▓█░                        
                         ░█▓▓▓▓██▓█████████████████████████▓█████▓█████▓█████▓█████▓█████████████████████████████████▓██▓▓▓▓██                        
                         █▓▓▓▓▓█▓███████████████▓████████████████████████████████████████████████████████████████████████▓▓▓▓█▓                       
                        ▓█▓▓▓▓█████████████████▓▓████████████████████████████████████████████████████████████▓█▓█████▓█▓██▓▓▓▓█▒                      
                       ▒█▓▓▓▓▓▓▓▓▓████████████████████████████████████████████████████████████████████████████████████▓▓▓▓▓▓▓▓▓█                      
                      ░█▓▓▓▓▓▓▓▓▓▓▓████████████████████████████████████████▓███████▓█████████████████████████████████▓▓▓▓▓▓▓▓▓▓██                     
                      ██▓▓▓▓▓▓▓▓▓▓▓███████████████████████████████▓█████████████████▓███████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓█▓                    
                     ▓█▓▓▓▓▓▓▓▓▓▓▓▓▓███████████████████████████████▓███████▓███████████████▓█████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓█░                   
                    ▒█▓▓▓▓▓▓▓▓▓▓▓▓▓███████████████████████████████▓█▓█████▓█▓███████████████▓███████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓██                   
                    █▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓█████████████████████████████████████████████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▓                  
                   ██▓▓▓▓▓▓▓▓▓▓▓▓▓▓█████████████████████████████████████████████████████████████████████████████████▓▓▓▓▓▓▓▓▓▓▓▓▓▓▓█▒                 
                  ▓██████████████████████████████████████████████████████████████████████████████████████████████████████████████████░                
                  ░▓▓▓▓▓▒▓▓▓▒▓▒▓▒▓▒▓▒▒▒▒▒▒▒▓▒▒▒▓▒▒▒▒▒▓▒▒▒▒▒▒▒▒▒▓▒▒▒▓▒▒▒▓▒▒▒▒▒▒▒▓▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▒▓▒▒▒▒▒▓▒▓▒▒▒▓▒▒▒▓▒▓▓▓▒▓▒▓▒▓▓▓▓▓▓                 
                                                                                                                                                      
                                                                                                                                                      




                                             ================================================================= 

                                                                Unowhy Tools by STY1001                                                                                                                                                      
                                                               A tool for Y13 computer !

                                                        https://sty1001.wordpress.com/unowhy-tools/
                                                         https://github.com/STY1001/Unowhy-Tools/

                                                Unowhy Tools and STY1001 are NOT affiliate with Unowhy !

                                                          Unowhy Tools is free and open source !

                                                               Don't steal my project/work ! 

                                             ================================================================= 
                                                                                                                                                                                                                                                                      

*/

using System;
using System.Collections.Generic;
using System.ComponentModel;
using System.Data;
using System.Drawing;
using System.Diagnostics;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.IO;
using Microsoft.Win32;
using System.Windows.Forms;
using System.Globalization;
using System.Resources;
using System.Net;
using System.Runtime.InteropServices;
using System.Windows;
using System.Threading;
using System.Windows.Input;
using System.ServiceProcess;
using Microsoft.WindowsAPICodePack.Shell;
using Microsoft.WindowsAPICodePack.Taskbar;
using System.Security.Principal;
using System.Windows.Forms.VisualStyles;

using Unowhy_Tools.Properties;
using static Unowhy_Tools.UTclass;
using Microsoft.WindowsAPICodePack.Dialogs.Controls;

namespace Unowhy_Tools
{   
    public partial class main : Form
    {
        #region Public Strings

        public string resxFile = "null";
        public string currentuser = "null";

        #endregion

        #region Check Service Function

        public bool serviceExists(string ServiceName)
        {
            return ServiceController.GetServices().Any(serviceController => serviceController.ServiceName.Equals(ServiceName));
        }

        #endregion

        #region Check admin

        public static bool checkAdmin()
        {
            WindowsIdentity identity = WindowsIdentity.GetCurrent();
            WindowsPrincipal principal = new WindowsPrincipal(identity);
            return principal.IsInRole(WindowsBuiltInRole.Administrator);
        }

        #endregion

        #region Run admin

        private void runAdmin()
        {
            if (!checkAdmin())
            {
                // Restart and run as admin
                var exeName = Process.GetCurrentProcess().MainModule.FileName;
                ProcessStartInfo startInfo = new ProcessStartInfo(exeName);
                startInfo.WorkingDirectory = Directory.GetCurrentDirectory();
                startInfo.Verb = "runas";
                string getidpath = Environment.GetFolderPath(Environment.SpecialFolder.UserProfile);
                startInfo.Arguments = $"-u {getidpath}";
                Process.Start(startInfo);
                Application.Exit();
                this.Close();
            }
        }

        #endregion

        #region Dark Title Bar and WOW64 Fix

        [DllImport("kernel32.dll", SetLastError = true)]
        static extern bool Wow64DisableWow64FsRedirection(ref IntPtr ptr);

        [DllImport("kernel32.dll", SetLastError = true)]
        static extern bool Wow64RevertWow64FsRedirection(IntPtr ptr);

        //Set dark mode title bar

        [DllImport("DwmApi")] 
        private static extern int DwmSetWindowAttribute(IntPtr hwnd, int attr, int[] attrValue, int attrSize);

        protected override void OnHandleCreated(EventArgs e)
        {
            DwmSetWindowAttribute(Handle, 19, new[] { 1 }, 4);
            DwmSetWindowAttribute(Handle, 20, new[] { 1 }, 4);
            DwmSetWindowAttribute(Handle, 35, new[] { 1 }, 4);
            DwmSetWindowAttribute(Handle, 38, new[] { 1 }, 4);
            IntPtr wow64Value = IntPtr.Zero;
            Wow64DisableWow64FsRedirection(ref wow64Value);
        }

        #endregion

        #region Check Internet Fonction

        [DllImport("wininet.dll")]
        private extern static bool InternetGetConnectedState(out int state, int value);

        #endregion

        public main(string userpath)
        {
            splashstatus.open();
            delay(300);

            #region Get info without admin

            if (checkAdmin())
            {
                /*string filePath9 = "%userprofile%\\Unowhy Tools\\temp\\workdir.txt";
                int lineNumber9 = 1;
                StreamReader inputFile9 = new StreamReader(filePath9);

                for (int i = 1; i < lineNumber9; i++)
                {
                    inputFile9.ReadLine();
                }
                string workdir = inputFile9.ReadLine();

                Directory.SetCurrentDirectory(workdir);*/

                if (!Directory.Exists($"{userpath}\\Unowhy Tools"))
                {
                   Directory.CreateDirectory($"{userpath}\\Unowhy Tools");
                }

                if (!Directory.Exists($"{userpath}\\Unowhy Tools\\temp"))
                {
                    Directory.CreateDirectory($"{userpath}\\Unowhy Tools\\temp");
                }

                if(!File.Exists($"{userpath}\\Unowhy Tools\\temp\\realid.txt"))
                {
                    string realid = System.Security.Principal.WindowsIdentity.GetCurrent().Name;
                    File.WriteAllText($"{userpath}\\Unowhy Tools\\temp\\realid.txt", realid);
                }

                if (!File.Exists($"{userpath}\\Unowhy Tools\\temp\\compuser.txt"))
                {
                    string compiduser = System.Security.Principal.WindowsIdentity.GetCurrent().Name;
                    File.WriteAllText($"{userpath}\\Unowhy Tools\\temp\\compuser.txt", compiduser);
                }

                if (!File.Exists($"{userpath}\\Unowhy Tools\\temp\\user.txt"))
                {
                    string iduser = Environment.UserName;
                    File.WriteAllText($"{userpath}\\Unowhy Tools\\temp\\user.txt", iduser);
                }
            }
            else
            {
                // Get user id of Invoker (Real user)
                string realid = System.Security.Principal.WindowsIdentity.GetCurrent().Name;
                string compiduser = System.Security.Principal.WindowsIdentity.GetCurrent().Name;
                string iduser = Environment.UserName;
                //string workdir = Directory.GetCurrentDirectory();
                string profpath = Environment.GetFolderPath(Environment.SpecialFolder.UserProfile);
                if (!Directory.Exists($"{profpath}\\Unowhy Tools"))
                {
                    Directory.CreateDirectory($"{profpath}\\Unowhy Tools");
                }
                if (!Directory.Exists($"{profpath}\\Unowhy Tools\\temp"))
                {
                    Directory.CreateDirectory($"{profpath}\\Unowhy Tools\\temp");
                }
                File.WriteAllText($"{profpath}\\Unowhy Tools\\temp\\realid.txt", realid);
                File.WriteAllText($"{profpath}\\Unowhy Tools\\temp\\compuser.txt", compiduser);
                File.WriteAllText($"{profpath}\\Unowhy Tools\\temp\\user.txt", iduser);
                //File.WriteAllText("%userprofile%\\Unowhy Tools\\temp\\workdir.txt", workdir);
                delay(300);
                splashstatus.close();
                InitializeComponent();
                runAdmin();
            }

            #endregion

            if (checkAdmin())
            {
                #region Cleanup Old Files

                if (File.Exists("temp\\adminusers.txt"))
                {
                    File.Delete("temp\\adminusers.txt");
                }
                if (File.Exists("temp\\azure.txt"))
                {
                    File.Delete("temp\\azure.txt");
                }
                if (File.Exists("temp\\ene.txt"))
                {
                    File.Delete("temp\\ene.txt");
                }
                if (File.Exists("temp\\entuser.txt"))
                {
                    File.Delete("temp\\entuser.txt");
                }
                if (File.Exists("temp\\gitversion.txt"))
                {
                    File.Delete("temp\\gitversion.txt");
                }
                if (File.Exists("temp\\hsmst.txt"))
                {
                    File.Delete("temp\\hsmst.txt");
                }
                if (File.Exists("temp\\ifp.txt"))
                {
                    File.Delete("temp\\ifp.txt");
                }
                if (File.Exists("temp\\mf.txt"))
                {
                    File.Delete("temp\\mf.txt");
                }
                if (File.Exists("temp\\model.txt"))
                {
                    File.Delete("temp\\model.txt");
                }
                if (File.Exists("temp\\os.txt"))
                {
                    File.Delete("temp\\os.txt");
                }
                if (File.Exists("temp\\pcname.txt"))
                {
                    File.Delete("temp\\pcname.txt");
                }
                if (File.Exists("temp\\rs.txt"))
                {
                    File.Delete("temp\\rs.txt");
                }
                if (File.Exists("temp\\shell.txt"))
                {
                    File.Delete("temp\\shell.txt");
                }
                if (File.Exists("temp\\username.txt"))
                {
                    File.Delete("temp\\username.txt");
                }
                if (File.Exists("azureleave.exe"))
                {
                    File.Delete("azureleave.exe");
                }
                if (File.Exists("bootim.exe"))
                {
                    File.Delete("bootim.exe");
                }
                if (File.Exists("cuaboff.exe"))
                {
                    File.Delete("cuaboff.exe");
                }
                if (File.Exists("cuabon.exe"))
                {
                    File.Delete("cuabon.exe");
                }
                if (File.Exists("delent.exe"))
                {
                    File.Delete("delent.exe");
                }
                if (File.Exists("delentf.exe"))
                {
                    File.Delete("delentf.exe");
                }
                if (File.Exists("delhismserv.exe"))
                {
                    File.Delete("delhismserv.exe");
                }
                if (File.Exists("deloem.exe"))
                {
                    File.Delete("deloem.exe");
                }
                if (File.Exists("delridf.exe"))
                {
                    File.Delete("delridf.exe");
                }
                if (File.Exists("disadmin.exe"))
                {
                    File.Delete("disadmin.exe");
                }
                if (File.Exists("dishis.exe"))
                {
                    File.Delete("dishis.exe");
                }
                if (File.Exists("enadmin.exe"))
                {
                    File.Delete("enadmin.exe");
                }
                if (File.Exists("enhis.exe"))
                {
                    File.Delete("enhis.exe");
                }
                if (File.Exists("fixti.exe"))
                {
                    File.Delete("fixti.exe");
                }
                if (File.Exists("fullsoftinfo.txt"))
                {
                    File.Delete("fullsoftinfo.txt");
                }
                if (File.Exists("fullpcinfo.txt"))
                {
                    File.Delete("fullpcinfo.txt");
                }
                if (File.Exists("getpcinfo.exe"))
                {
                    File.Delete("getpcinfo.exe");
                }
                if (File.Exists("getsoftinfo.exe"))
                {
                    File.Delete("getsoftinfo.exe");
                }
                if (File.Exists("getuserinfo.exe"))
                {
                    File.Delete("getuserinfo.exe");
                }
                if (File.Exists("langen.exe"))
                {
                    File.Delete("langen.exe");
                }
                if (File.Exists("langfr.exe"))
                {
                    File.Delete("langfr.exe");
                }
                if (File.Exists("old2new"))
                {
                    File.Delete("old2new");
                }
                if (File.Exists("rdti.exe"))
                {
                    File.Delete("rdti.exe");
                }
                if (File.Exists("reboot.exe"))
                {
                    File.Delete("reboot.exe");
                }
                if (File.Exists("rmdirhismgr.exe"))
                {
                    File.Delete("rmdirhismgr.exe");
                }
                if (File.Exists("shell.exe"))
                {
                    File.Delete("shell.exe");
                }
                if (File.Exists("starthis.exe"))
                {
                    File.Delete("starthis.exe");
                }
                if (File.Exists("stophis.exe"))
                {
                    File.Delete("stophis.exe");
                }
                if (File.Exists("Unowhy Tools Updater.exe"))
                {
                    File.Delete("Unowhy Tools Updater.exe");
                }
                if (File.Exists("utconfdel.exe"))
                {
                    File.Delete("utconfdel.exe");
                }
                if (File.Exists("utkeydel.exe"))
                {
                    File.Delete("utkeydel.exe");
                }
                if (File.Exists("version.txt"))
                {
                    File.Delete("version.txt");
                }
                if (File.Exists("winhelloent.exe"))
                {
                    File.Delete("winhelloent.exe");
                }
                if (File.Exists("winre.exe"))
                {
                    File.Delete("winre.exe");
                }
                if (File.Exists("update.zip"))
                {
                    File.Delete("update.zip");
                }
                if (File.Exists("delhisqool.exe"))
                {
                    File.Delete("delhisqool.exe");
                }
                if (File.Exists("ene.txt"))
                {
                    File.Delete("ene.txt");
                }
                if (File.Exists("model.txt"))
                {
                    File.Delete("model.txt");
                }
                if (File.Exists("os.txt"))
                {
                    File.Delete("os.txt");
                }
                if (File.Exists("pcname.txt"))
                {
                    File.Delete("pcname.txt");
                }
                if (File.Exists("tversion.txt"))
                {
                    File.Delete("tversion.txt");
                }
                if (File.Exists("username.txt"))
                {
                    File.Delete("username.txt");
                }
                if (File.Exists("clog.html"))
                {
                    File.Delete("clog.html");
                }

                #endregion

                #region First Start

                //File.WriteAllText(".\\temp\\verbose.txt", "Preparing...");

                Write2Log("First start...");

                if (Directory.Exists("temp"))
                {

                }
                else
                {
                    Directory.CreateDirectory("temp");
                    Write2Log("First start... (Create Temp)");
                    //File.WriteAllText(".\\temp\\verbose.txt", "Preparing for first start...");
                }

                RegistryKey keysty = Registry.CurrentUser.OpenSubKey(@"Software\STY1001", false);   //Check if the  "STY1001" key exist
                if (keysty != null)
                {

                }
                else
                {
                    RegistryKey stykey = Registry.CurrentUser.OpenSubKey(@"Software", true);    //Create it
                    stykey.CreateSubKey("STY1001");
                    delay(300);
                    Write2Log("First start... (Create Key STY1001)");
                }

                RegistryKey keyut = Registry.CurrentUser.OpenSubKey(@"Software\STY1001\Unowhy Tools", false);   //Check if "UT" key exist
                if (keyut != null)
                {

                }
                else
                {
                    RegistryKey utkey = Registry.CurrentUser.OpenSubKey(@"Software\STY1001", true);     //Create it with "Lang" value
                    utkey.CreateSubKey("Unowhy Tools");
                    delay(300);
                    Write2Log("First start... (Create Key UT)");

                }

                RegistryKey key = Registry.CurrentUser.OpenSubKey(@"SOFTWARE\STY1001\Unowhy Tools");       //Open key
                object us = key.GetValue("UpdateStart", null);
                if (us != null)
                {

                }
                else
                {
                    runmin("reg", "add \"HKCU\\Software\\STY1001\\Unowhy Tools\" /v UpdateStart /d 1 /t REG_SZ /f", false);
                    Write2Log("First start... (Create Value US)");
                }

                object o = key.GetValue("Lang", null);
                if (o != null)
                {

                }
                else
                {
                    runmin("reg", "add \"HKCU\\Software\\STY1001\\Unowhy Tools\" /v Lang /d EN /t REG_SZ /f", false);
                    Write2Log("First start... (Create Value Lang)");
                    delay(1000);
                    var s = new Settings("1");
                    splashstatus.close();
                    s.ShowDialog();
                    splashstatus.open();

                    delay(100);
                }

                delay(300);

                #endregion

                #region Update System

                object u = key.GetValue("UpdateStart", null);
                if (u != null)
                {
                    string utlu = key.GetValue("UpdateStart").ToString();
                    if (utlu == "1")
                    {
                        string noco = "0";

                        int Out;
                        if (InternetGetConnectedState(out Out, 0) == true) noco = "0";
                        else noco = "1";

                        if (noco == "1")
                        {
                            var s = new nonet();
                            splashstatus.close();
                            s.ShowDialog();
                            splashstatus.open();
                        }
                        else
                        {
                            if (File.Exists(".\\fr.resx"))    //Check if the file exist
                            {
                                File.Delete(".\\fr.resx");    //Delete it if exist
                            }
                            if (File.Exists(".\\en.resx"))    //Check if the file exist
                            {
                                File.Delete(".\\en.resx");    //Delete it if exist
                            }

                            string gitver;
                            string progver = Resources.ver.ToString();

                            using (var client = new WebClient())
                            {
                                gitver = client.DownloadString("https://raw.githubusercontent.com/STY1001/Unowhy-Tools/master/Update/Version.txt");
                                if (!File.Exists("debug"))
                                {
                                    client.DownloadFile("https://raw.githubusercontent.com/STY1001/Unowhy-Tools/master/Update/fr.resx", ".\\fr.resx");         //Update Languages
                                    client.DownloadFile("https://raw.githubusercontent.com/STY1001/Unowhy-Tools/master/Update/en.resx", ".\\en.resx");         //Update Languages
                                }
                                else
                                {
                                    client.DownloadFile("https://raw.githubusercontent.com/STY1001/Unowhy-Tools/master/Unowhy%20Tools/Lang/fr.resx", ".\\fr.resx");         //Update Languages
                                    client.DownloadFile("https://raw.githubusercontent.com/STY1001/Unowhy-Tools/master/Unowhy%20Tools/Lang/en.resx", ".\\en.resx");         //Update Languages
                                }
                            }

                            int gitint = Convert.ToInt32(gitver);       //Convert string to int
                            int progint = Convert.ToInt32(progver);

                            if (progint < gitint)        //Check if there is a new vertion of UT
                            {
                                var s = new newver();
                                splashstatus.close();
                                s.ShowDialog();
                                splashstatus.open();
                            }
                            else if(gitint < progint)
                            {
                                splashstatus.close();
                                var d = new info("This is a pre-release", Properties.Resources.yes);
                                d.ShowDialog();
                                splashstatus.open();
                            }
                        }
                    }
                }
                else
                {

                }

                #endregion
            }

            InitializeComponent();

            if (checkAdmin())
            {
                #region Debug Mode Visibility

                if (File.Exists("debug"))
                {
                    debuglab.Visible = true;
                    debuser.Visible = true;
                    debud.Visible = true;
                }

                #endregion

                langswitch();
                Write2Log("Lang apply");
                userid(userpath);
                Write2Log("debuser");
                check();
                Write2Log("Check");

                //Go to foreground
                this.WindowState = FormWindowState.Minimized;
                this.Show();
                this.WindowState = FormWindowState.Normal;
                Write2Log("Ready!");
            }
            splashstatus.close();
        }

        #region Lang System

        //Lang System

        public void langswitch()
        {
            starthis.Text = getlang("starthis");
            stophis.Text = getlang("stophis");
            enhis.Text = getlang("enhis");
            dishis.Text = getlang("dishis");  
            delhis.Text = getlang("delhis");
            delhism.Text = getlang("delhism");
            delcat.Text = getlang("delcat");
            repaircat.Text = getlang("repaircat");
            servicecat.Text = getlang("servicecat");
            shell.Text = getlang("shell");
            fixboot.Text = getlang("fixboot");
            ent.Text = getlang("ent");
            delti.Text = getlang("delti");
            about.Text = getlang("about");
            settings.Text = getlang("settings");
            delridf.Text = getlang("delridf");
            winre.Text = getlang("winre");
            pcname.Text = getlang("pcname");
            cuscat.Text = getlang("cuscat");
            deloem.Text = getlang("deloem");
            entf.Text = getlang("delentf");
            pcinfo.Text = getlang("pcinfo");
            admin.Text = getlang("admin");
            aadleave.Text = getlang("aadleave");
            adduser.Text = getlang("adduser");
            adminset.Text = getlang("adminset");
            back.Text = getlang("back");
            drivercat.Text = getlang("drvcat");
            delhismserv.Text = getlang("delhismserv");
            rest.Text = getlang("rest");
            enwhe.Text = getlang("enwhe");
            guide.Text = getlang("guide");
            opencmd.Text = getlang("opencmd");
            unprog.Text = getlang("unprog");
            opengp.Text = getlang("opengp");
            openreg.Text = getlang("openreg");
            opentask.Text = getlang("opentask");
            bootim.Text = getlang("bootim");
            bcdfail.Text = getlang("bcdfail");
            bkcloud.Text = getlang("bkcloud");
            string ver = Unowhy_Tools.Properties.Resources.Version.ToString();
            version.Text = ver;
        }

        #endregion

        #region Custom Func

        public void userid(string iduserpath)
        {
            string filePath = $"{iduserpath}\\Unowhy Tools\\temp\\realid.txt";
            int lineNumber = 1;
            StreamReader inputFile = new StreamReader(filePath);

            for (int i = 1; i < lineNumber; i++)
            {
                inputFile.ReadLine();
            }
            string nameid = inputFile.ReadLine();
            Write2Log($"Current user id: {nameid}");

            if (nameid.Contains("AzureAD") == true)
            {
                string filePath2 = $"{iduserpath}\\Unowhy Tools\\temp\\compuser.txt";
                int lineNumber2 = 1;
                StreamReader inputFile2 = new StreamReader(filePath2);

                for (int i = 1; i < lineNumber2; i++)
                {
                    inputFile2.ReadLine();
                }
                string nameid2 = inputFile2.ReadLine();
                debuser.Text = nameid2;
            }
            else
            {
                string filePath2 = $"{iduserpath}\\Unowhy Tools\\temp\\user.txt";
                int lineNumber2 = 1;
                StreamReader inputFile2 = new StreamReader(filePath2);

                for (int i = 1; i < lineNumber2; i++)
                {
                    inputFile2.ReadLine();
                }
                string nameid2 = inputFile2.ReadLine();
                debuser.Text = nameid2;
            }
        }

        public void new_check()
        {
            Write2Log("====== Dynamic Buttons ======");
            ProgBar.Visible = true;

            string azure = getline(returncmd("powershell", "start-process -FilePath \"dsregcmd\" -ArgumentList \"/status\" -nonewwindow"), 6);
            string admins = returncmd("net", "localgroup Administrateurs");
            string users = returncmd("net", "user");
            string bcd = returncmd("bcdedit", "");

            #region Hisqool Manager

            Write2Log("=== HSM service ===");
            if (serviceExists("HiSqoolManager"))
            {
                ServiceController sc = new ServiceController();
                sc.ServiceName = "HiSqoolManager";

                if(sc.StartType == ServiceStartMode.Automatic)
                {
                    if(sc.Status == ServiceControllerStatus.Running)
                    {
                        dbtn(starthis);
                        ebtn(stophis);
                        dbtn(enhis);
                        ebtn(dishis);
                        Write2Log("HSM is running");
                    }
                    else
                    {
                        dbtn(stophis);
                        ebtn(starthis);
                        dbtn(enhis);
                        ebtn(dishis);
                        Write2Log("HSM is stopped");
                    }
                }
                else
                {
                    dbtn(starthis);
                    dbtn(stophis);
                    dbtn(dishis);
                    ebtn(enhis);
                    Write2Log("HSM is disabled");
                }
                if(!File.Exists("C:\\Program Files\\Unowhy\\HiSqool Manager\\HiSqoolManager.exe"))
                {
                    dbtn(starthis);
                    dbtn(stophis);
                    dbtn(dishis);
                    dbtn(enhis);
                    Write2Log("HSM is deleted");
                }
            }
            else
            {
                dbtn(starthis);
                dbtn(stophis);
                dbtn(dishis);
                dbtn(enhis);
                dbtn(delhismserv);
                Write2Log("HSM services is not present");
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region Azure

            Write2Log("=== Azure AD ===");
            if (azure.Contains("NO"))
            {
                dbtn(aadleave);
                Write2Log("Azure AD joined: NO");
            }
            else
            {
                ebtn(aadleave);
                Write2Log("Azure AD joined: YES");
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region Admins

            Write2Log("=== Admins ===");
            if (admins.Contains(debuser.Text))
            {
                dbtn(admin);
                Write2Log("User is admin");
            }
            else
            {
                ebtn(admin);
                Write2Log("User is not admin");
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region Folders

            Write2Log("=== Folders ===");
            if (Directory.Exists("C:\\ProgramData\\RIDF") == false)
            {
                dbtn(delridf);
                Write2Log("RIDF: False");
            }
            else
            {
                ebtn(delridf);
                Write2Log("RIDF: True");
            }
            if (Directory.Exists("C:\\ProgramData\\ENT") == false)
            {
                dbtn(entf);
                Write2Log("ENT: False");
            }
            else
            {
                ebtn(entf);
                Write2Log("ENT: True");
            }
            if (Directory.Exists("C:\\Windows\\sysnative\\OEM") == false)
            {
                dbtn(deloem);
                Write2Log("OEM: False");
            }
            else
            {
                ebtn(deloem);
                Write2Log("OEM: True");
            }
            if (Directory.Exists("C:\\Program Files\\Unowhy\\TO_INSTALL") == false)
            {
                dbtn(delti);
                Write2Log("TO_INSTALL: False");
            }
            else
            {
                ebtn(delti);
                Write2Log("TO_INSTALL: True");
            }
            if (Directory.Exists("C:\\Program Files\\Unowhy\\HiSqool Manager") == false)
            {
                dbtn(delhism);
                Write2Log("Hisqool Manager: False");
            }
            else
            {
                ebtn(delhism);
                Write2Log("Hisqool Manager: True");
            }
            if (Directory.Exists("C:\\Program Files\\Unowhy\\HiSqool") == false)
            {
                dbtn(delhis);
                Write2Log("Hisqool: False");
            }
            else
            {
                ebtn(delhis);
                Write2Log("Hisqool: True");
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region ENT user

            Write2Log("=== ./ENT ===");
            if (users.Contains("ENT"))
            {
                ebtn(ent);
                Write2Log("ENT User is present");
            }
            else
            {
                dbtn(ent);
                Write2Log("ENT User is not present");
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region Windows Hello Enterprise

            Write2Log("=== Win Hello Ent ===");
            RegistryKey whe1 = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Policies\\Microsoft\\PassportForWork");
            RegistryKey whe2 = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WinBio\\Credential Provider");
            RegistryKey whe3 = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Policies\\Microsoft\\PassportForWork\\DynamicLock");
            if (whe1 == null || /*whe2 == null ||*/ whe3 == null)
            {
                ebtn(enwhe);
                Write2Log("WHE No Key");
            }
            else
            {
                string val5 = whe3.GetValue("DynamicLock").ToString();
                //string val2 = whe2.GetValue("Domain Accounts").ToString();
                string val1 = whe1.GetValue("Enabled").ToString();
                string val3 = whe1.GetValue("RequireSecurityDevice").ToString();
                //string val4 = whe1.GetValue("UseCertificateForOnPremAuth").ToString();

                if (val1 == null || val3 == null || val5 == null)
                {
                    ebtn(enwhe);
                    Write2Log("WHE No Value");
                }
                else
                {
                    if (val1.Contains("1") && /*val2.Contains("1") &&*/ val3.Contains("1") && /*val4.Contains("1") &&*/ val5.Contains("1"))
                    {
                        dbtn(enwhe);
                        Write2Log("WHE OK");
                    }
                    else
                    {
                        ebtn(enwhe);
                        Write2Log("WHE Not OK");
                    }
                }
            }
            if(whe1 != null)
            {
                whe1.Close();
            }
            if (whe2 != null)
            {
                whe2.Close();
            }
            if (whe3 != null)
            {
                whe3.Close();
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region TI Start

            Write2Log("=== Auto script of TI ===");
            DirectoryInfo dir = new DirectoryInfo("C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup");
            FileInfo[] files = dir.GetFiles("silent_" + "*.*");
            if (files.Length > 0)
            {
                ebtn(fixboot);
                Write2Log("Present");
            }
            else
            {
                dbtn(fixboot);
                Write2Log("Not present");
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region BootIM

            Write2Log("=== BootIM ===");
            RegistryKey bim1 = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\bootim.exe");
            if (bim1 == null)
            {
                dbtn(bootim);
                Write2Log("OK");
            }
            else
            {
                ebtn(bootim);
                Write2Log("Redirected");
            }
            if(bim1 != null)
            {
                bim1.Close();
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region BCDedit

            Write2Log("=== BCD ===");
            if (bcd.Contains("IgnoreAllFailures"))
            {
                ebtn(bcdfail);
                Write2Log("BCD patched");
            }
            else
            {
                dbtn(bcdfail);
                Write2Log("BCD normal");
            }
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            #region Shell

            Write2Log("=== Shell ===");
            RegistryKey shellkey = Registry.LocalMachine.OpenSubKey("SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Winlogon");
            string shellval = shellkey.GetValue("Shell").ToString();
            if(shellval == "explorer.exe")
            {
                dbtn(shell);
            }
            else
            {
                ebtn(shell);
            }
            Write2Log($"Shell: {shellval}");
            Write2Log("=== End ===" + Environment.NewLine);

            #endregion

            ProgBar.Visible = false;
            Write2Log("====== End ======");
        }
        public void check()
        {
            #region Enable buttons
            ebtn(delhis);
            ebtn(delhism);
            ebtn(deloem);
            ebtn(delridf);
            ebtn(dishis);
            ebtn(enhis);
            ebtn(stophis);
            ebtn(starthis);
            ebtn(ent);
            ebtn(entf);
            ebtn(delti);
            ebtn(aadleave);
            ebtn(pcname);
            ebtn(admin);
            ebtn(adminset);
            ebtn(adduser);
            ebtn(winre);
            ebtn(fixboot);
            ebtn(delhismserv);
            ebtn(back);
            ebtn(shell);
            ebtn(enwhe);
            ebtn(rest);
            ebtn(bkcloud);
            ebtn(bootim);
            #endregion

            new_check();
        }

        #endregion

        #region Buttons Action

        private void starthis_Click(object sender, EventArgs e)
        {
            string msg = starthis.Text;
            Image ico = Resources.start;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                serv.start("Hisqoolmanager");
                check();
                if (!starthis.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
                      
        }

        private void stophis_Click(object sender, EventArgs e)
        {
            string msg = stophis.Text;
            Image ico = Resources.stop;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                serv.stop("Hisqoolmanager");
                check();
                if (!stophis.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void enhis_Click(object sender, EventArgs e)
        {
            string msg = enhis.Text;
            Image ico = Resources.enable;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                serv.auto("Hisqoolmanager");
                check();
                if (!enhis.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void dishis_Click(object sender, EventArgs e)
        {
            string msg = dishis.Text;
            Image ico = Resources.disable;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                serv.dis("Hisqoolmanager");
                check();
                if (!dishis.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void delhis_Click(object sender, EventArgs e)
        {
            string msg = delhis.Text;
            Image ico = Resources.uninstall;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                System.Diagnostics.Process.Start("C:\\Program Files\\Unowhy\\HiSqool\\Uninstall Hisqool.exe");
                check();
                /*if (!delhis.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }*/
            }
        }

        private void delhism_Click(object sender, EventArgs e)
        {
            string msg = delhism.Text;
            Image ico = Resources.service;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                serv.del("Hisqoolmanager");
                runmin("rmdir", "/s /q C:\\Program Files\\Unowhy\\HisqoolManager", true);
                check();
                if (!delhism.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void shell_Click(object sender, EventArgs e)
        {
            string msg = shell.Text;
            Image ico = Resources.explorer;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("reg", "add \"HKLM\\Software\\Microsoft\\Windows NT\\CurrentVersion\\WinLogon\" /v Shell /d explorer.exe /t REG_SZ /f", true);
                check();
                if (!shell.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void delent_Click(object sender, EventArgs e)
        {
            string msg = ent.Text;
            Image ico = Resources.deluser;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("net", "user ENT /delete", true);
                check();
                if (!ent.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void about_Click(object sender, EventArgs e)
        {
            var a = new About();    //Launch About form
            a.ShowDialog();
        }

        private void fixboot_Click(object sender, EventArgs e)
        {
            string msg = fixboot.Text;
            Image ico = Resources.script;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("del", "/q /f \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\silent_*.*\"", true);
                check();
                if (!fixboot.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void delti_Click(object sender, EventArgs e)
        {
            string msg = delti.Text;
            Image ico = Resources.folder;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("del", "/q /f \"C:\\ProgramData\\Microsoft\\Windows\\Start Menu\\Programs\\Startup\\silent_*.*\"", true);
                runmin("rmdir", "/s /q \"C:\\Program Files\\Unowhy\\TO_INSTALL\"", true);
                check();
                if (!delti.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void settings_Click(object sender, EventArgs e)
        {
            var s = new Settings("0");     //Show settings
            s.ShowDialog();
            langswitch();
        }

        private void delridf_Click(object sender, EventArgs e)
        {
            string msg = delridf.Text;
            Image ico = Resources.folder;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("rmdir", "/s /q \"C:\\ProgramData\\RIDF\"", true);
                check();
                if (!delridf.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void winre_Click(object sender, EventArgs e)
        {
            /*
            string msg = winre.Text;
            dialog d = new dialog(msg);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                TaskbarManager.Instance.SetProgressState(TaskbarProgressBarState.Indeterminate);
                Thread t = new Thread(new ThreadStart(WaitScreen));
                t.Start();
                                                                               //Enable reagentc
                Process p = new Process();
                p.StartInfo.FileName = ".\\winre.exe";
                p.StartInfo.Arguments = "";
                p.StartInfo.WindowStyle = ProcessWindowStyle.Minimized;
                p.Start();
                p.WaitForExit();
                debreagentc.Text = "Enabled";
                changeswitch();
                t.Abort();
                TaskbarManager.Instance.SetProgressState(TaskbarProgressBarState.NoProgress);
            }
            */

            var wre = new winreset();
            wre.ShowDialog();
        }

        private void pcname_Click(object sender, EventArgs e)
        {
            var pcn = new PCName();     // Change the Name of PC
            pcn.ShowDialog();
        }

        private void deloem_Click(object sender, EventArgs e)
        {
            string msg = deloem.Text;
            Image ico = Resources.folder;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("rmdir", "/s /q \"C:\\Windows\\System32\\OEM\"", true);
                check();
                if (!deloem.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void logo_Click(object sender, EventArgs e)
        {
            // Presentation Mode

            var p = new pmod();
            p.Show();
        }

        private void delentf_Click(object sender, EventArgs e)
        {
            string msg = entf.Text;
            Image ico = Resources.folder;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("rmdir", "/s /q \"C:\\ProgramData\\ENT\"", true);
                check();
                if (!entf.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void pcinfo_Click(object sender, EventArgs e)
        {
            var pci = new PCInfo(debuser.Text);
            pci.ShowDialog();
        }

        private void aadleave_Click(object sender, EventArgs e)
        {
            string msg = aadleave.Text;
            Image ico = Resources.azure;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("dsregcmd", "/leave", true);
                check();
                if (!aadleave.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void admin_Click(object sender, EventArgs e)
        {
            string msg = admin.Text;
            Image ico = Resources.admin;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("net", $"localgroup Administrateurs /add \"{debuser.Text}\"", true);
                check();
                if (!admin.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void adduser_Click(object sender, EventArgs e)
        {
            var u = new Adduser();     //Show Add user
            u.ShowDialog();
        }

        private void adminset_Click(object sender, EventArgs e)
        {
            var a = new AdminSet();     //Show Admin Settings
            a.ShowDialog();
        }

        private void delserv_Click(object sender, EventArgs e)
        {
            string msg = delhismserv.Text;
            Image ico = Resources.delete;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                serv.del("Hisqoolmanager");
                check();
                if (!delhismserv.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void rest_Click(object sender, EventArgs e)
        {
            var r = new restore();
            r.ShowDialog();
        }

        private void back_Click(object sender, EventArgs e)
        {
            var b = new backup();
            b.ShowDialog();
        }

        private void opencmd_Click(object sender, EventArgs e)
        {
            System.Diagnostics.Process.Start("cmd.exe");
        }

        private void unprog_Click(object sender, EventArgs e)
        {
            System.Diagnostics.Process.Start("ms-settings:appsfeatures");
        }

        private void guide_Click(object sender, EventArgs e)
        {
            System.Diagnostics.Process.Start("https://github.com/STY1001/Unowhy-Tools/blob/master/GUIDE.md");
        }

        private void enwhe_Click(object sender, EventArgs e)
        {
            string msg = enwhe.Text;
            Image ico = Resources.fp;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("reg", "add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\PassportForWork\" /v \"EnablePinRecovery\" /t REG_DWORD /d \"1\" /f", true);
                runmin("reg", "add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\PassportForWork\" /v \"RequireSecurityDevice\" /t REG_DWORD /d \"1\" /f", true);
                runmin("reg", "add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\PassportForWork\" /v \"Enabled\" /t REG_DWORD /d \"1\" /f", true);
                runmin("reg", "add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\PassportForWork\" /v \"DisablePostLogonProvisioning\" /t REG_DWORD /d \"0\" /f", true);
                runmin("reg", "add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\PassportForWork\\DynamicLock\" /v \"DynamicLock\" /t REG_DWORD /d \"1\" /f", true);
                runmin("reg", "add \"HKLM\\SOFTWARE\\Policies\\Microsoft\\PassportForWork\\DynamicLock\" /v \"Plugins\" /t REG_SZ /d \"<rule schemaVersion=\\\"1.0\\\"> <signal type=\\\"bluetooth\\\" scenario=\\\"Dynamic Lock\\\" classOfDevice=\\\"512\\\" rssiMin=\\\"-10\\\" rssiMaxDelta=\\\"-10\\\"/> </rule> \" /f", true);
                runmin("reg", "add \"HKLM\\SOFTWARE\\Microsoft\\Windows\\CurrentVersion\\WinBio\\Credential Provider\" /v \"Domain Accounts\" /t REG_DWORD /d \"1\" /f", true);
                check();
                if (!enwhe.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void bkcloud_Click(object sender, EventArgs e)
        {
            System.Diagnostics.Process.Start("https://hksty1001-my.sharepoint.com/:f:/g/personal/cloud_sty1001_cf/Ejk2S5pcwCFPnUxKDVQaUPoBpw-3IMAjuLYiJO_Fi-vsKQ?e=SAI4SS");
        }

        private void opengp_Click(object sender, EventArgs e)
        {
            System.Diagnostics.Process.Start("gpedit.msc");
        }

        private void openreg_Click(object sender, EventArgs e)
        {
            System.Diagnostics.Process.Start("regedit.exe");
        }

        private void opentask_Click(object sender, EventArgs e)
        {
            System.Diagnostics.Process.Start("taskmgr.exe");
        }
        private void bootim_Click(object sender, EventArgs e)
        {
            string msg = bootim.Text;
            Image ico = Resources.registry;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("reg", "delete \"HKLM\\SOFTWARE\\Microsoft\\Windows NT\\CurrentVersion\\Image File Execution Options\\bootim.exe\" /f", true);
                check();
                if (!bootim.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void debug_Click(object sender, EventArgs e)  // Enable all button (debug mode)
        {
            ebtn(delhis);
            ebtn(delhism);
            ebtn(deloem);
            ebtn(delridf);
            ebtn(dishis);
            ebtn(enhis);
            ebtn(stophis);
            ebtn(starthis);
            ebtn(ent);
            ebtn(entf);
            ebtn(delti);
            ebtn(aadleave);
            ebtn(pcname);
            ebtn(admin);
            ebtn(adminset);
            ebtn(adduser);
            ebtn(winre);
            ebtn(fixboot);
            ebtn(delhismserv);
            ebtn(back);
            ebtn(shell);
            ebtn(enwhe);
            ebtn(rest);
            ebtn(bkcloud);
            ebtn(bootim);
            ebtn(bcdfail);
        }

        private void debugenable_Click(object sender, EventArgs e)  // Enable all button (debug mode)
        {
            string msg = "Debug Mode (Restart to apply)";
            Image ico = Resources.question;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                File.Create(".\\debug");
            }
        }

        private void bcdfail_Click(object sender, EventArgs e)
        {
            string msg = bcdfail.Text;
            Image ico = Resources.boot;
            dialog d = new dialog(msg, ico);
            d.ShowDialog();
            if (d.DialogResult.Equals(DialogResult.Yes))
            {
                runmin("bcdedit", "/deletevalue bootstatuspolicy", true);
                check();
                if (!bcdfail.Enabled)
                {
                    var i = new info(getlang("done"), Properties.Resources.yes);
                    i.ShowDialog();
                }
                else
                {
                    var i = new info(getlang("failed"), Properties.Resources.no);
                    i.ShowDialog();
                }
            }
        }

        private void debud_Click(object sender, EventArgs e)
        {
            WebClient client = new WebClient();
            client.DownloadFile(new Uri("https://raw.githubusercontent.com/STY1001/Unowhy-Tools/master/Update/Unowhy%20Tools%20Updater.exe"), ".\\updater.exe");
            System.Diagnostics.Process.Start(".\\updater.exe");
        }

        #endregion

        #region Buttons Description

        private void desc_Clean(object sender, EventArgs e)
        {
            desc.Text = "";
        }

        private void desc_Hism(object sender, EventArgs e)
        {
            desc.Text = getlang("deschism");
        }

        private void desc_Shell(object sender, EventArgs e)
        {
            desc.Text = getlang("descshell");
        }

        private void desc_Fixti(object sender, EventArgs e)
        {
            desc.Text = getlang("descstart");
        }

        private void desc_Winre(object sender, EventArgs e)
        {
            desc.Text = getlang("descwinre");
        }

        private void desc_Ent(object sender, EventArgs e)
        {
            desc.Text = getlang("descent");
        }

        private void desc_His(object sender, EventArgs e)
        {
            desc.Text = getlang("deschisdel");
        }

        private void desc_Delhism(object sender, EventArgs e)
        {
            desc.Text = getlang("deschismdel");
        }

        private void desc_Delti(object sender, EventArgs e)
        {
            desc.Text = getlang("desctidel");
        }

        private void desc_Ridf(object sender, EventArgs e)
        {
            desc.Text = getlang("descridf");
        }

        private void desc_Oem(object sender, EventArgs e)
        {
            desc.Text = getlang("descdeloem");
        }

        private void desc_Entf(object sender, EventArgs e)
        {
            desc.Text = getlang("descdelentf");
        }

        private void desc_PCN(object sender, EventArgs e)
        {
            desc.Text = getlang("descpcname");
        }

        private void desc_Admin(object sender, EventArgs e)
        {
            desc.Text = getlang("descadmin");
        }

        private void desc_logo(object sender, EventArgs e)
        {
            desc.Text = "Presentation Mode (Display all form of Unowhy Tools / Affiche tous les form. de Unowhy Tools)";
        }

        private void desc_Aadleave(object sender, EventArgs e)
        {
            desc.Text = getlang("descaadleave");
        }

        private void desc_Adduser(object sender, EventArgs e)
        {
            desc.Text = getlang("descadduser");
        }

        private void desc_Adminset(object sender, EventArgs e)
        {
            desc.Text = getlang("descadminset");
        }

        private void desc_delserv(object sender, EventArgs e)
        {
            desc.Text = getlang("descadminset");
        }

        private void desc_drvbr(object sender, EventArgs e)
        {
            desc.Text = getlang("drvbr");
        }

        private void desc_enwhe(object sender, EventArgs e)
        {
            desc.Text = getlang("descenwhe");
        }

        private void desc_bkcloud(object sender, EventArgs e)
        {
            desc.Text = getlang("descbkcloud");
        }

        private void desc_bootim(object sender, EventArgs e)
        {
            desc.Text = getlang("descbootim");
        }

        private void desc_bcdfail(object sender, EventArgs e)
        {
            desc.Text = getlang("descbcdfail");
        }

        #endregion
    }
}
